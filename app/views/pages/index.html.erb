<% if user_signed_in? && !current_user.try(:admin) %>

<div class="page-header">
  <h1>My Dashboard</h1>
</div>

<% if @announcement %>
<div class="alert alert-info alert-dismissible">
  <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
  <h5>Announcement</h5>
  <p class="small"><strong><%= @announcement.subject %> :-</strong> <%= @announcement.description %></p>
</div>
<% end %>


<div class="row">
  <div class="col-md-6">
    <h3>Account Information: <small><%= link_to "Update Your Details", account_path %></small></h3>
    <hr>
    <p class="lead"><%= current_user.profile.nama_penuh %></p>
    <p>
      <%= current_user.profile.address1 %><br>
      <%= current_user.profile.address2 %><br>
      <%= current_user.profile.postcode %>, <%= current_user.profile.city %><br>
      <%= current_user.profile.state %>, <%= current_user.profile.country %><br>
    </p>
  </div>
  <div class="col-md-6">
    <h3>Account Overview: </h3>
    <hr>
    <p>Number of Order: <strong><%= @order.count %></strong></p>
    <p>Total of Order Amount: <strong>RM <%= current_user.orders.sum(:total_price) %>0</strong></p>
    <p>Total of Payment: <strong>RM <%= current_user.payments.sum(:total_payment) %>0</strong></p>
    <p>Total of Voucher: <strong>RM <%= current_user.vouchers.sum(:total_payment) %>0</strong></p>
  </div>
</div>

<hr>
  <h3>Order Overview for KJ06 Programme: </h3>
  <div class="table-responsive">
    <table class="table table-bordered table-hover" id="overviewkj06Details">
      <thead>
        <tr>
          <th class="col-md-2">Programme</th>
          <th class="col-md-2">Total Weight</th>
          <th class="col-md-2">Total Discount</th>
          <th class="col-md-2">Discount Date</th>
        </tr>
      </thead>
      <tbody>
      <% @order.each do |order| %>
        <% if order.package_id == 6 %>
        <tr>
          <td><%= order.package.package_name %></td>
          <td><%= order.gram_quantity %> gram</td>
          <td>RM <%= order.total_discount %></td>
          <td><%= order.discount.discount_date %></td>
        </tr>
        <% end %>
      <% end %>
      </tbody>
    </table>
  </div>

  <h3>Order Overview for Others Programme: </h3>
  <div class="table-responsive">
    <table class="table table-bordered table-hover" id="overviewDetails">
      <thead>
        <tr>
          <th class="col-md-2">Programme</th>
          <th class="col-md-2">Total Weight</th>
          <th class="col-md-2">Price</th>
          <th class="col-md-2">Total Price</th>
        </tr>
      </thead>
      <tbody>
      <% @order.each do |order| %>
        <% if order.package_id != 6 %>
        <tr>
          <td><%= order.package.package_name %></td>
          <td><%= order.gram_quantity %> gram</td>
          <td>RM <%= order.price %></td>
          <td>RM <%= order.total_price %></td>
        </tr>
        <% end %>
      <% end %>
      </tbody>
    </table>
  </div>

<hr>

<div id="chart" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<script type="text/javascript">
$(function visitorData (data) {
  $('#chart').highcharts({
    chart: {
      type: 'column'
    },
    title: {
      text: 'Performance Report (per week)'
    },
    xAxis: {
      type: "datetime",
      title: {
          text: "Date for 1 week"
      }
    },
    yAxis: {
      title: {
          text: 'Amount (MYR)'
      }
    },
    tooltip: {
      formatter: function(){
        return Highcharts.dateFormat("%B %e, %Y", this.x) + ': ' + "<b>RM" + Highcharts.numberFormat(this.y, 2) + "</b>";
      }
    },
    series: [{
      name: 'Total Order',
      pointInterval: <%= 1.1.day * 1000 %>,
      pointStart: <%= 1.weeks.ago.to_i * 1000 %>,
      data: 
      	<% @orders = Order.where("user_id = ?", current_user.id) %>
      	<%= (1.weeks.ago.to_date..Date.today ).map { |date| @orders.total_on(date).to_f }.inspect %>

    }, {
      name: 'Payment Send',
      pointInterval: <%= 1.1.day * 1000 %>,
      pointStart: <%= 1.weeks.ago.to_i * 1000 %>,
      data:
      	<% @payments = Payment.where("user_id = ?", current_user.id) %> 
      	<%= (1.weeks.ago.to_date..Date.today).map { |date| @payments.total_on(date).to_f }.inspect %>

    }, {
      name: 'Voucher Received',
      pointInterval: <%= 1.1.day * 1000 %>,
      pointStart: <%= 1.weeks.ago.to_i * 1000 %>,
      data:
      	<% @vouchers = Voucher.where("user_id = ?", current_user.id) %>
      	<%= (1.weeks.ago.to_date..Date.today).map { |date| @vouchers.total_on(date).to_f }.inspect %>

    }]
  });
});
</script>

<% elsif current_user.try(:admin) %>

	<h1>I'm an admin</h1>

<% else %>

	<div class="jumbotron">
	  <h1>Gold is Real Money!</h1>
	  <p>Throughout history no paper currency has survived in its original form. Paper currencies are normally inflated away until they are worthless.</p>
	  <p><a class="btn btn-primary btn-lg" role="button">Learn more</a></p>
	</div>

	<div class="page-header">
	  <h1><center>Gold Solution & Management Tracking System</center></h1>
	  <p class="lead">
	    <center>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum gravida nisl. Etiam nisi lacus, dignissim eget pretium in, dictum vel nisl. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vivamus justo eros, tincidunt id consectetur ut, dignissim non purus. Fusce eu dapibus massa</center>
	  </p>
	</div>

<% end %>

<script type="text/javascript">
$(document).ready( function () {
    $('#overviewDetails').DataTable();
    $('#overviewkj06Details').DataTable();
} );
</script>